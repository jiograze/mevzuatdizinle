<!-- Generated by SpecStory -->

# Uygulama modülleri için uzman raporu ve öneriler (2025-08-10 10:57Z)

_**User**_

uygulamada eksik/geliştirme önerin varmı modüller tam özelliklerini veriyormu uzman raporu hazırla

---

_**Assistant**_

Kod tabanını inceleyip modül bazlı eksik ve iyileştirme alanlarını saptamak için kilit dosyaları okuyorum. Eksik ve iyileştirme alanlarını tespit için kalan yardımcı modülleri okuyorum. Mevcut özelliklerin kapsamını ve eksikleri belirlemek için dokümantasyon dosyalarını okuyorum. Modüllerin eksik/uyumsuz yönlerini doğru belirlemek için arayüz ve yardımcı modülleri de inceliyorum. Eksik ve hataları doğru tespit için yardımcı modülleri (logger, text_processor, query_expansion) inceliyorum. Uygulamanın mevcut kod tabanı incelendi. Aşağıda modül bazlı durum, eksikler, riskler ve somut geliştirme önerileri içeren uzman raporu yer alıyor.

## Yürütücü Özet
Genel mimari modüler ve mantıklı (core, utils, ui, izleme, arama, sınıflandırma). Temel fonksiyonlar (dosya işleme, sınıflandırma, madde ayrıştırma, FTS arama, semantik arama opsiyonel, dosya izleme, notlar, favoriler, basit UI) mevcut. Ancak:
- Tutarsızlıklar ve yinelenen/bozuk kod parçaları var (özellikle search_engine ve text_processor’da metot duplikasyonları).
- Bazı vaat edilen özellikler README’de anlatılmış ama kodda yok (PDF raporlama, gelişmiş yedekleme, diff raporu, parola koruması, şifreleme, performans log detayları, kullanıcı kategorileri UI’sı, undo sistemi).
- İyileştirilmemiş veri modeli (ör. JSON metadata alanı string; normalize edilmemiş).
- Arama tarafında semantik indeks oluşturma süreci tam bütünleşmemiş ve iki farklı rebuild_index tanımı çakışıyor.
- Test kapsamı belirsiz; test dosyaları var ama otomasyon ve kenar durumlar muhtemelen eksik.
- Hata dayanıklılığı ve transaction geri alma (undo) tablosu kullanıma alınmamış.
- Konfigürasyon esnekliği ve doğrulama eksik.

Önceliklendirilmiş öneriler bölümüne bakınız.

## Modül Bazlı Değerlendirme

### `app_manager.py`
Durum: Başlatma zinciri açık, ancak:
- İlk çalıştırma sihirbazı sadece klasör oluşturuyor; kullanıcıya UI akışı yok.
- Hata durumunda kısmen inisyalize olmuş nesnelerin temizlik stratejisi yok (yarım kalmış connection vs).
Öneri:
- Atomic init: Her adım için doğrulama + rollback planı.
- Lazy initialization (örn. embedding modeli ilk semantik aramada).

### `database_manager.py`
Artılar:
- Temel tablolar + indeksler iyi.
- FTS5 kullanımı var.
Eksikler / Riskler:
- JSON saklanan metadata TEXT (şema + sorgulama zor). (SQLite JSON1 kullanılabilir.)
- UNIQUE(file_hash) var fakat aynı dosyanın farklı mantıksal versiyonlarını yönetmek için versionlama kurgusu eksik (version_number var ama upgrade akışı yok).
- “operations” tablosu (undo) tanımlı ama fonksiyonellik hiç uygulanmamış.
- Arama geçmişi tablosunda kolon adı README’deki örnekle tutarsız (README’de “query_text”, kodda “query”).
- search_engine.get_suggestions() yanlış kolonu (query_text) sorguluyor (bug).
- Transaction context manager’da isolation / busy retry yok.
Öneri:
- JSON alanları için: metadata TEXT yerine JSON -> PRAGMA compile_options kontrol + json_extract bazlı sorgular.
- Undo mekanizmasını gerçekten kullan (insert/update wrapper).
- Arama geçmişi kolon adları hizala veya migration yaz.
- Sık kullanılan rapor sorguları için VIEW’ler.

### `document_processor.py`
Artılar:
- Çoklu PDF motor fallback.
- Duplicate file hash kontrolü.
Eksikler:
- Büyük dosya işleme için stream / incremental parse yok.
- OCR fallback kritik ama kalite metriği (confidence) kullanılmıyor.
- Hata/success sonuç sözlükleri için tip güvence (dataclass) yok; UI tarafında tutarsız risk.
- re işlemleri optimize edilmemiş (önceden compile).
- Kaydetme sırasında toplu insert yok (maddeler tek tek).
Öneri:
- Maddeleri batch insert (executemany).
- Bellek izini azaltmak için page-by-page pipeline (özellikle uzun PDF).
- OCR çıktısı kalite metriğini (pytesseract config + confidences) parse et.
- Article extraction pattern sayısı genişletilebilir (ör. Roma rakamı maddeler).

### `file_watcher.py`
Durum:
- Kararlılık kontrolü (boyut 3 ardışık ölçüm) iyi.
Eksikler / Riskler:
- Duplicate işleme riskine karşı veritabanı sorgusu (hash) ilk kuyruk öncesi yok (sadece processor’da var; boşa CPU).
- Sağlık kontrolü statik aralıkta, dinamizm yok.
- Çok fazla dosya geldiğinde Queue backpressure / concurrency limiti yok.
Öneri:
- Hash erken kontrol (enqueue öncesi).
- Kuyruk uzunluğuna göre throttle / exponential backoff.
- metrics: processed per minute, failure ratio.

### `search_engine.py`
Artılar:
- Keyword + semantic + fusion yaklaşımı.
- Gelişmiş (boost / fusion) iskelet.
Eksikler / Hatalar:
- İKİ ADET rebuild_index tanımı (biri üstte FAISS ile, altta farklı API – çakışma; alttaki önceki tanımı override eder). Bu ciddi bakım hatası.
- İkinci rebuild_index içinde SELECT article_id FROM articles… fakat tablo kolon adı id; article_id yok (SQL hata potansiyeli).
- search_history tablosunda query_type kolon adı doğru; suggestion metodunda query_text kolonu kullanılıyor (bug).
- FAISS article_id_map / embedding_id_map tutarsız isimler (biri article_id_map, rebootta embedding_id_map).
- Model yoksa graceful fallback tamam ama semantic arama parametre validasyonu zayıf.
- _prepare_fts_query Türkçe dil için stemming / diacritics normalization yapmıyor.
- Cache FIFO primitive (LRU veya TTL yok).
Öneri:
- Tek rebuild_index fonksiyonuna konsolide et, test ekle.
- Türkçe kök bulma (snowball stemmer / Zemberek opsiyonel) veya basit normalizasyon.
- Score normalizasyon: FTS rank + cosine skorlarını min-max.
- Query expansion gerçek sinonim sözlüğü (şu anda kodunu görmedik ama kontrol edilmeli).
- Cache için OrderedDict + eviction policy.

### `config_manager.py`
Eksikler:
- Şema doğrulama (pydantic / cerberus yok).
- Ortam değişkeni override desteği (ENV prefix) yok.
- Kaydetme concurrency kilidi yok.
Öneri:
- Config schema ve tip validasyonu.
- get() için varsayılan tip dönüşümü (örn. bool).
- Base folder değişince türev yolların yeniden türetilmesi (şu anda statik yüklenmiş kalabilir).

### `document_classifier.py`
Eksikler:
- Regex tabanlı; ML veya rule weighting yok (confidence kaba).
- Law number çıkarma fazlasıyla geniş regex ile false positive üretir.
- Kategori belirleme “score > best_score” ama yakın skor eşitliği durumunda denge yok.
Öneri:
- Weighted keyword TF-IDF domain dictionary.
- Tarih parsing: PDF metadata'daki “D:YYYYMMDD…” formatını parse et (PDF standardı).
- Başlık çıkarma için satır bazlı heuristik (uppercase yoğunluğu) ekle.

### `faceted_search.py`
Eksikler:
- Facet değerleri sadece mevcut sonuçlardan türetiliyor (global istatistik yok).
- Range facet için numerik content_length gerçek değeri yok (SearchResult içinde yok).
- publication_date string format — year transform basit string kesme (geçersiz format crash riski).
Öneri:
- Facet precomputation (materialized view).
- content_length alanını indexe (articles) ekle (content_length INTEGER).
- Tarih parse güvenli try/except + sentinel.

### `text_processor.py`
Hatalar:
- clean_text ve slugify iki kez tanımlanmış (ikinciler ilkinin üstünü yazar; farklı davranış -> sessiz mantık değişikliği).
- Article extraction pattern’leri noktalama normalizasyonu nedeniyle bazı formatları kaçırabilir.
- Fıkra bölme naive (regex split kaybı).
Öneri:
- Tek clean_text (arama için ayrıca normalizasyon pipeline).
- Gelişmiş madde/fıkra parse: state machine veya deterministik parser.
- Stop words set genişlet.

### `logger.py`
Eksikler:
- Performans logger JSON şekli kısmi (detay alanları structured değil).
- async / queue handler yok (UI tıkanabilir).
Öneri:
- QueueHandler + tüketici thread.
- performance.jsonl içine operation_id, duration_ms, tags.

### UI (main_window.py ve alt widget’lar)
Eksikler:
- Ayarlarda yapılan değişikliklerin bir kısmı uygulanmıyor (TODO).
- PDF export TODO (README’de vaat).
- Tarihe göre sıralama TODO.
- Erişilebilirlik (klavye odak, kontrast) yok.
- Uzun işlem (indeks rebuild) iptal seçeneği yok.
Öneri:
- Uzun işler için QThread + cancel token.
- PDF export: ReportLab veya WeasyPrint entegrasyonu.
- Lazy load / sanal liste (büyük sonuç setleri için).
- Kullanıcı notları versiyonlama (updated_at gösterimi).

### Güvenlik / Dayanıklılık
Eksikler:
- Dosya adı manipülasyonunda path traversal mitigasyonu yok (kopyalama öncesi Path.resolve kontrol).
- Şifreleme yok (README’de “şifreleme” yazıyor).
- Parola / rolleri yok (multi-user senaryosu).
Öneri:
- İsteğe bağlı SQLite encryption (SQLCipher) katmanı.
- Dosya organizasyonu öncesi safe path enforcement.
- Hash collision mitigation (SHA256 tercih).

### Performans
İyileştirme fırsatları:
- Insert batch.
- Embedding oluşturma sırasında progress & min-batching (GPU opsiyon).
- FTS5 optimize (optimize komutu; trigram tokenizer / unicode61 + remove accents).
- Article content_clean hesaplaması pipeline / vectorize.

### Test / Kalite
Eksikler:
- Test dosyaları var ama coverage / fixture sistemi görünmüyor.
- Kenar durum testleri (boş PDF, bozuk PDF, çok büyük dosya).
- Performance regression test yok.
Öneri:
- Pytest + coverage raporu + threshold.
- Property-based tests (article parser).
- Yapay test corpusu (farklı mevzuat formatları).

### Observability
Eksikler:
- Memory / CPU ölçümü yok.
- Arama kalite metriği (örn. click-through) yok.
Öneri:
- Basit metrics.jsonl (timestamp, type, value).
- Health endpoint (headless modda CLI).

### Dağıtım
Eksikler:
- build_exe.py var ama dependency trimming / cache yok.
- Model indirilebilirliği offline mod için kontrol edilmemiş.
Öneri:
- “first-run wizard” UI: model indir, OCR path test, disk alanı kontrol.

## README’de Vaat Edilip Kodda Bulunmayan / Eksik Uygulanan Başlıklar
| Özellik | Durum | Not |
|---------|-------|-----|
| PDF Raporlama | Yok | export_results TODO |
| Yedekleme (backup klasörü) | Mantık yok | Sadece klasör |
| Undo / İşlem geçmişi | Tablonuz var | Kodda kullanım yok |
| Kullanıcı kategorileri (user_categories) | UI yok | Tablolar var |
| Parola / Şifreleme | Yok | README iddia ediyor |
| Diff raporları | Yok | |
| Faceted “kurum”, “durum” | Veritabanında karşılık yok (institution, status alanları article/dokümanda kapsamlı doldurulmuyor) | |
| Gelişmiş arama önerileri | Basit geçmiş | Query expansion içerikleri yok |

## Önceliklendirilmiş Geliştirme Yol Haritası (İlk 6 Sprint Önerisi)

1. Kritik Hatalar (Sprint 1)
- search_engine rebuild_index fonksiyon çatışmasını düzelt.
- search_history kolon uyumsuzluğu (query_text vs query) -> migration + kod düzeltmesi.
- text_processor duplicate clean_text/slugify birleştir.
- Suggestion metodundaki yanlış SQL.
2. Veri Modeli / Temel Sağlamlaştırma (Sprint 2)
- metadata JSON formatına geçiş (ALTER TABLE + json_valid doğrulama).
- content_length kolonu ekle (migration).
- operations tablosu için wrapper (insert/update/delete hook).
3. Performans & Stabilite (Sprint 3)
- Batch insert (articles).
- FAISS yeniden indeksleme tekil ve güvenli (geçici indeks + swap).
- File watcher hash pre-check.
4. Özellik Tamamlama (Sprint 4)
- PDF raporlama (basit template + başlık + tablo).
- Facet engine: eksik alanların kaynakta doldurulması (publication_date normalizasyonu; status).
- Undo (operations tablosu).
5. Arama Kalite İyileştirme (Sprint 5)
- Türkçe normalizasyon (accent fold).
- Basit stemming veya kök eşleme sözlüğü.
- Skor füzyonu normalizasyonu + LRU cache.
- Arama öneri modeli (popüler + n-gram).
6. Güvenlik ve Dayanıklılık (Sprint 6)
- SHA256 hash + duplicate stratejisi.
- Dosya path güvenliği.
- Opsiyonel veritabanı şifreleme (config flag).
- Yedekleme (zamanlanmış zip + retention).

## Öneri Tablosu (Seçme Kritikler)

| Başlık | Sorun | Öneri | Öncelik | Tahmini Efor |
|--------|-------|-------|---------|--------------|
| rebuild_index çakışması | Fonksiyon override | Tek, testli implementasyon | Yüksek | 0.5 gün |
| text_processor duplikasyon | İki farklı mantık | Ortak util, tek sürüm | Yüksek | 0.5 gün |
| search_history kolon uyumsuzluğu | get_suggestions hatası | Migration + kod düzeltmesi | Yüksek | 0.5 gün |
| metadata serileştirme | Sorgulanamaz TEXT | JSON1 + json_extract | Orta | 1 gün |
| Batch insert yok | Performans düşer | executemany | Orta | 0.5 gün |
| Undo yok | Geri alma yok | operations hook | Orta | 2 gün |
| PDF export eksik | Vaat karşılanmıyor | ReportLab entegrasyonu | Orta | 1 gün |
| FAISS tutarsız mapping | Potansiyel kayıp | Tek mapping sözlüğü | Orta | 0.5 gün |
| Arama skor füzyonu | Dengesiz | Min-max veya z-score | Orta | 0.5 gün |
| Path güvenliği | Risk | resolve + base path check | Orta | 0.25 gün |
| OCR kalite metriği | Kör kabul | Confidence parse | Düşük | 0.5 gün |
| Facet content_length | Öznitelik eksik | Kolon + populate | Orta | 0.5 gün |

## Teknik Borç Öne Çıkanlar
- Yinelenen fonksiyon tanımları (code smell).
- Veri katmanında domain servis ayrışımı yok (document + article logic dağınık).
- Exception handling çoğunlukla generic (log + swallow).
- Sihirli string ve sabitler (patternler) kod içine gömülü; konfigüre edilebilir değil.

## Hızlı Kazanımlar (Quick Wins)
- search_history SQL bug fix.
- text_processor fonksiyon birleştirme.
- FTS optimize: PRAGMA optimize; vacuum sonrası çağır.
- Logger’a QueueHandler eklemek (UI donma riskini azaltır).
- content_length alanını doldurma (mevcut kayıtlar için UPDATE).

## Orta Vadeli Değer Katacaklar
- Article diff (aynı law_number + version_number > 1 karşılaştırması).
- Semantic incremental index: only new articles appended (şu an var ama persist stratejisi belirsiz).
- Facet global sayımları (kullanıcı arama bağlamı dışında keşif).
- ML tabanlı belge türü sınıflandırıcı (fastText veya küçük transformer).

## Riskler
| Risk | Etki | Azaltma |
|------|------|---------|
| rebuild_index override | Yanlış indeks, semantik arama bozuk | Refactor + test |
| metadata ham TEXT | Gelecek sorgular zor | JSON migration |
| Üretimde blocking I/O | UI donmaları | Worker thread/pool |
| Eksik hata sınıflandırması | Log analizi zor | Özel exception sınıfları |
| Güvenlik (path traversal) | İstenmeyen dosya erişimi | Path normalization |

## Test Önerileri (Öncelikli Set)
1. document_processor.process_file()  
   - Bozuk PDF  
   - Duplicate hash  
   - Çok küçük içerik (<50 char)  
2. search_engine.search()  
   - keyword / semantic disabled / mixed  
   - cache hit & miss  
3. rebuild_index tam döngü  
4. file_watcher kararlılık (gecikmeli büyüyen dosya)  
5. text_processor madde parse (çeşitli formatlar)  
6. database migration (search_history kolon düzeltmesi)

## İzleme (Monitoring) Önerileri
- performance.jsonl genişlet: {op, duration_ms, success, payload_size}
- Arama başarı metriği: results_count dağılımı histogram.
- Gecikme P95/P99 offline analiz script.

## Sonuç
Çekirdek işlevler çalışabilir durumda ancak bazı kritik hatalar (rebuild_index çakışması, SQL kolon uyumsuzluğu, fonksiyon duplikasyonları) giderilmezse ölçeklenme ve bakım zorlaşır. İlk etapta kalite / bütünlük / indeks güvenilirliği stabil hale getirilmeli; ardından vaat edilen eksik özellikler (PDF export, undo, backup) tamamlanmalıdır.

Devam etmek isterseniz önce “kritik hata düzeltme” sprintine girilebilir; isterseniz bu ilk paketin yamalarını hazırlayabilirim. Yönlendirin yeter.

---

_**User**_

bunda göre tamamla uygulamayı ve eksikleri tammla uzman olarak düzelt

---

_**Assistant**_

Gerekli bağımlılıkları ve olası PDF kütüphanesini görmek için requirements.txt dosyasını okuyorum. 
```

```
Text processor’daki çift tanım ve temizleme işlevini sadeleştirmek için düzenleme yapıyorum. 
```

```
text_processor dosyasındaki indentation hatasını düzeltmek için fonksiyon bloğunu yeniden yazıyorum. 
```

```
PDF raporlama temel iskeleti eklemek için yeni bir export_report modülü oluşturuyorum ve main_window içindeki TODO çağrısını bağlayacağım. PDF export fonksiyonunu UI'ya bağlamak için main_window içindeki TODO kısmını güncelliyorum. PDF export TODO satırını gerçek çağrı ile değiştirmek için ilgili fonksiyon bölümünü düzenliyorum. 
````

````


---

_**User**_

devam

---

_**Assistant**_



---

